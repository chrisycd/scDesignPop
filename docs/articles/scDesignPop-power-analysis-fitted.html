<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Power analysis based on a fitted scDesignPop marginal model â€¢ scDesignPop</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Power analysis based on a fitted scDesignPop marginal model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scDesignPop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9005</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/scDesignPop.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/scDesignPop-celltype-prop-modeling.html">Model cell type proportions for new individuals</a></li>
    <li><a class="dropdown-item" href="../articles/scDesignPop-modify-eQTL-effects.html">Modify eQTL effect for eGenes / non-eGenes</a></li>
    <li><a class="dropdown-item" href="../articles/scDesignPop-power-analysis-fitted.html">Power analysis based on a fitted scDesignPop marginal model</a></li>
    <li><a class="dropdown-item" href="../articles/scDesignPop-power-analysis-selected.html">Power analysis for selected genes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/chrisycd/scDesignPop/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Power analysis based on a fitted scDesignPop marginal model</h1>
                        <h4 data-toc-skip class="author">Chris Dong</h4>
            <address class="author_afil">
      Department of Statistics and Data Science, University of
California, Los
Angeles<br><a class="author_email" href="mailto:#"></a><a href="mailto:cycd@g.ucla.edu" class="email">cycd@g.ucla.edu</a>
      </address>
                              <h4 data-toc-skip class="author">Yihui
Cen</h4>
            <address class="author_afil">
      Department of Computational Medicine, University of California,
Los Angeles<br><a class="author_email" href="mailto:#"></a><a href="mailto:yihuicen@g.ucla.edu" class="email">yihuicen@g.ucla.edu</a>
      </address>
                  
            <h4 data-toc-skip class="date">21 May 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/chrisycd/scDesignPop/blob/HEAD/vignettes/scDesignPop-power-analysis-fitted.Rmd"><code>vignettes/scDesignPop-power-analysis-fitted.Rmd</code></a></small>
      <div class="d-none name"><code>scDesignPop-power-analysis-fitted.Rmd</code></div>
    </div>

    
    
<style type="text/css">
pre {
  white-space: pre !important;
  overflow-x: scroll !important;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>scDesignPop provides power analysis tools at cell-type-specific
level. Since fitted marginal models can be obtained by users already for
generating synthetic datasets, the tutorial here is about how to conduct
the power analysis on the basis of the marginal model files.</p>
</div>
<div class="section level2">
<h2 id="library-and-data-preparation">Library and data preparation<a class="anchor" aria-label="anchor" href="#library-and-data-preparation"></a>
</h2>
<p>Here, we load the pre-saved <code>marginal_list</code> object to
obtain the fitted marginal model of gene ENSG00000163221 (S100A12) for
simplicity.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chrisycd/scDesignPop">scDesignPop</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"/home/ycen/proj/scEQTLsim/data/tutorials/marginal_list_sel.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">marginal_list_sel</span><span class="op">$</span><span class="va">ENSG00000163221</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: nbinom2  ( log )</span></span>
<span><span class="co">#&gt; Formula:          </span></span>
<span><span class="co">#&gt; response ~ (1 | indiv) + cell_type + `1:153337943` + `1:153337943`:cell_type</span></span>
<span><span class="co">#&gt; Data: res_list[["dmat_df"]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;  11088.7  11158.3  -5534.4  11068.7     7801 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;  Groups Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  indiv  (Intercept) 0.08141  0.2853  </span></span>
<span><span class="co">#&gt; Number of obs: 7811, groups:  indiv, 40</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dispersion parameter for nbinom2 family (): 1.15 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)                    1.80392    0.07763  23.237   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; cell_typemononc               -4.65391    0.22215 -20.949   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; cell_typebmem                 -5.96487    0.31401 -18.996   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; cell_typecd4nc                -6.44683    0.22816 -28.256   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; `1:153337943`                 -0.02273    0.08603  -0.264    0.792    </span></span>
<span><span class="co">#&gt; cell_typemononc:`1:153337943` -0.15160    0.27980  -0.542    0.588    </span></span>
<span><span class="co">#&gt; cell_typebmem:`1:153337943`   -0.55004    0.39328  -1.399    0.162    </span></span>
<span><span class="co">#&gt; cell_typecd4nc:`1:153337943`  -0.16812    0.29164  -0.576    0.564    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performing-power-analysis">Performing power analysis<a class="anchor" aria-label="anchor" href="#performing-power-analysis"></a>
</h2>
<p>Given fitted marginal model, scDesignPop can perform simulation-based
power analysis for a specific gene-SNP pair across selected cell types
using the <code>runPowerAnalysis</code> function. Based on the previous
naming of covariates, we specify the fitted snpid as
<code>"1:153337943"</code>, the name of the column for fixed cell state
effect and random individual effect as <code>"cell_type"</code> and
<code>"indiv"</code> in the input parameters. To check these namings, we
can call the covariate data frame using
<code>marginal_list_sel[["ENSG00000163221"]]$fit$frame</code>. The
selected cell types for testing are specified in cellstate_vector and
have to be consistent with the covariate data frame.</p>
<p>Particarly, parameters <code>snp_number</code> and
<code>gene_number</code> are used to account for multiple testing
correction with Bonferroni correction. Parameter <code>methods</code> is
used to specify the marginal eQTL model from
<code>c("nb", "poisson", "gaussian", "pseudoBulkLinear")</code>.
Parameter <code>nindivs</code> and <code>ncells</code> are used to
specify the number of individuals and number of cells per individual,
from which we can analyze the performance of power analysis and find the
optimal setting.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">power_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runPowerAnalysis.html">runPowerAnalysis</a></span><span class="op">(</span>marginal_list <span class="op">=</span> <span class="va">marginal_list_sel</span>,</span>
<span>                               geneid <span class="op">=</span> <span class="st">"ENSG00000163221"</span>,</span>
<span>                               snpid <span class="op">=</span> <span class="st">"1:153337943"</span>,</span>
<span>                               cellstate_colname <span class="op">=</span> <span class="st">"cell_type"</span>,</span>
<span>                               cellstate_vector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bmem"</span>, <span class="st">"monoc"</span><span class="op">)</span>,</span>
<span>                               indiv_colname <span class="op">=</span> <span class="st">"indiv"</span>,</span>
<span>                               methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>,<span class="st">"pseudoBulkLinear"</span><span class="op">)</span>,</span>
<span>                               nindivs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>                               ncells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>                               alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                               power_nsim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                               snp_number <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                               gene_number <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                               CI_nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                               CI_conf <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                               ncores <span class="op">=</span> <span class="fl">50L</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -4.160949</span></span>
<span><span class="co">#&gt; [1] -0.5727631</span></span>
<span><span class="co">#&gt; [1] 1.803924</span></span>
<span><span class="co">#&gt; [1] -0.02272728</span></span>
<span><span class="co">#&gt; [1] -4.160949</span></span>
<span><span class="co">#&gt; [1] -0.5727631</span></span>
<span><span class="co">#&gt; [1] 1.803924</span></span>
<span><span class="co">#&gt; [1] -0.02272728</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualization-of-power-results">Visualization of power results<a class="anchor" aria-label="anchor" href="#visualization-of-power-results"></a>
</h2>
<p>The power analysis results can be visualized using the
<code>visualizePowerResult</code> function. The cell type names in the
<code>cellstate_vector</code> must be included in the above power
analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualizePowerResult.html">visualizePowerResult</a></span><span class="op">(</span>power_result <span class="op">=</span> <span class="va">power_data</span>,</span>
<span>                     cellstate_vector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bmem"</span>, <span class="st">"monoc"</span><span class="op">)</span>,</span>
<span>                     x_axis <span class="op">=</span> <span class="st">"nindiv"</span>,</span>
<span>                     y_axis <span class="op">=</span> <span class="st">"ncell"</span>,</span>
<span>                     col_group <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>                     geneid <span class="op">=</span> <span class="st">"ENSG00000163221"</span>,</span>
<span>                     snpid <span class="op">=</span> <span class="st">"1:153337943"</span><span class="op">)</span></span></code></pre></div>
<p><img src="scDesignPop-power-analysis-fitted_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>By swaping the x and y axis, we can show the result in a different
way.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualizePowerResult.html">visualizePowerResult</a></span><span class="op">(</span>power_result <span class="op">=</span> <span class="va">power_data</span>,</span>
<span>                     cellstate_vector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bmem"</span>, <span class="st">"monoc"</span><span class="op">)</span>,</span>
<span>                     x_axis <span class="op">=</span> <span class="st">"ncell"</span>,</span>
<span>                     y_axis <span class="op">=</span> <span class="st">"nindiv"</span>,</span>
<span>                     col_group <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>                     geneid <span class="op">=</span> <span class="st">"ENSG00000163221"</span>,</span>
<span>                     snpid <span class="op">=</span> <span class="st">"1:153337943"</span><span class="op">)</span></span></code></pre></div>
<p><img src="scDesignPop-power-analysis-fitted_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chris Y. Dong, Yihui Cen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
